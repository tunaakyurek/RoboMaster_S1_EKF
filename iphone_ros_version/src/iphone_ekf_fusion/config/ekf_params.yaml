# EKF 15-DOF Configuration Parameters
# Following RoboMaster EKF Formulary specifications

# Process Noise Covariance Q
# These values determine how much the filter trusts the motion model
process_noise:
  position: 0.01          # Position drift (m^2/s)
  velocity: 0.1           # Velocity drift (m^2/s^3)
  orientation: 0.05       # Orientation drift (rad^2/s)
  angular_velocity: 0.1   # Angular velocity drift (rad^2/s^3)
  accel_bias: 0.001      # Accelerometer bias drift (m^2/s^5)

# Measurement Noise Covariance R
# These values determine how much the filter trusts each sensor
measurement_noise:
  accelerometer: 0.5      # Accelerometer noise (m^2/s^4)
  gyroscope: 0.1         # Gyroscope noise (rad^2/s^2)
  magnetometer: 0.5      # Magnetometer noise (T^2)
  gps: 1.0               # GPS position noise (m^2)
  barometer: 0.1         # Barometer noise (Pa^2)

# Initial State Covariance P0
# Initial uncertainty in state estimates
initial_covariance:
  position: 1.0          # Initial position uncertainty (m^2)
  velocity: 0.5          # Initial velocity uncertainty (m^2/s^2)
  orientation: 0.1       # Initial orientation uncertainty (rad^2)
  angular_velocity: 0.1  # Initial angular velocity uncertainty (rad^2/s^2)
  accel_bias: 0.01      # Initial bias uncertainty (m^2/s^4)

# Physical Constants
physics:
  gravity: 9.81          # Gravitational acceleration (m/s^2)
  magnetic_declination: 0.0  # Magnetic declination for location (rad)
  air_pressure_sea_level: 101325.0  # Sea level pressure (Pa)

# Sensor Configuration
sensors:
  imu:
    use_imu: true
    imu_rate: 100.0      # Hz
    apply_bias_correction: true
    
  gps:
    use_gps: true
    min_satellites: 4
    max_hdop: 5.0
    outlier_threshold: 10.0  # meters
    
  magnetometer:
    use_magnetometer: true
    min_field_strength: 20.0  # μT
    max_field_strength: 60.0  # μT
    
  barometer:
    use_barometer: true
    outlier_threshold: 100.0  # Pa

# Filter Settings
filter:
  prediction_rate: 50.0   # Hz
  max_time_between_updates: 1.0  # seconds
  enable_outlier_rejection: true
  enable_adaptive_noise: false
  
# Convergence Criteria
convergence:
  position_tolerance: 0.1      # meters
  velocity_tolerance: 0.05     # m/s
  orientation_tolerance: 0.02  # radians
  
# Debug Settings
debug:
  verbose: false
  publish_debug_topics: true
  save_covariance_history: false
  log_outliers: true
